-# customer gets passed in from layout
- usdrate = RateCode.for_course_credit("USD").value
- inrrate = RateCode.for_course_credit("INR").value
- payment = Payment.new credits: customer.credit_balance, cash_value: customer.credit_balance * (customer.currency == "USD" ? usdrate : inrrate), currency: customer.currency

#m-refund-credits.modal.fade.wide{ role: :dialog }
  .row-fluid
    %h1#headline.title= "Refund Gredits"
    .small You will receive an email from PayPal on how to access your refund
    -#.span6
      = image_tag "landing/paypal-cards.jpg", :id => "img-payment-icons"
    = simple_form_for payment, :url => refund_path, :validate => true, :remote => true, :html => { :id => 'fm-refund-credits' }, :defaults => { :label => false } do |f|
      .row-fluid
        .span6
          %h3 Account Balance 
          = f.input :credits, :readonly => true, :input_html => { :id => "total-amt", :tabindex => -2 , :value => "#{payment.credits} Gredits" }
          -#.row-fluid
            .span7
              = f.input :credits, :readonly => true, :input_html => { :id => "total-amt", :tabindex => -2 , :value => "#{customer.credit_balance}", :class => "input-small" }
            .span5
              = f.select :currency, [["@ $#{usdrate}", "USD"], ["@ â‚¹#{inrrate}", "INR"]]
          %h3 Refund to
          -#.control-group.required
            .controls
              = f.select :source, [["Visa", "visa"], ["MasterCard", "master"],["Discover","discover"],["American Express","american_express"]]
          -#= f.input :card_number, :placeholder => "Card Number", :input_html => { :maxlength => 16 }
          -#.row-fluid
            .span8
              = f.date_select :expiration, :discard_day => true, :start_year => Date.today.year, :end_year => (Date.today.year+10), :use_two_digit_numbers => true, :order => [:month, :year], :date_separator => "/ ", :label => "Expires"
            .span4.pull-right
              = f.input :card_verification, :placeholder => "CVV", :input_html => { :maxlength => 3, :class => "input-micro" }
          = f.input :name, :placeholder => "Name", :input_html => { :maxlength => 60, :value => "#{customer.account.loggable.name}" } 
        .span6
          %h3 Amount Refundable*
          = f.input :cash_value, :readonly => true, :input_html => { :id => "total-amt", :tabindex => -1, :value => "#{payment.display_value}" }
          %h3 Email
          = f.input :email, :placeholder => "Email", :input_html => { :maxlength => 35 , :value => "#{customer.account.email}" }
          -#= f.input :country, :priority => ["India", "United States", "United Kingdom"]
          -#= f.input :address1, :placeholder => "Address Line 1"
          -#= f.input :city, :placeholder => "City"
          -#= f.input :state, :placeholder => "State / Province"
          -#= f.input :zip, :placeholder => "Postal Code (ZIP/PIN)"
      .row-fluid
        #message.alert.alert-error.hide
        %button.btn.btn-inverse.btn-large.push-down.pull-left{ :type => :reset, :id => 'btn-reset' }= "Clear Form"
        %button.btn.btn-primary.btn-large.push-down.pull-right{ :type => :submit, :id => 'btn-submit' }= "Process Refund"
    %p *Final amount refundable after fees and processing charges

