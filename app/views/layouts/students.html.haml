
-# Customized markers 
- student = current_account.loggable
- s = "#{Gutenberg['server']}"

-# Define contents_for 
- for j in [:toolbox, :menus, :modals, :notifications]
  - content_for j do 
    - klass = (j == :toolbox) ? 'hidden' : ''
    -  m = (j == :toolbox) ? ['generic', 'preview'].map{ |a| "toolbox/#{a}" } : ['student','shared'].map{ |a| "#{j}/#{a}" }
    - partials_f = m.map{ |b| "app/views/#{b}" }
    %div{ id: j, class: klass }
      - for f in partials_f
        - Dir["#{f}/*.haml"].each do |p| 
          = render file: Rails.root.join(p), locals: { server: s }
      -# render exceptions here 
      - if j == :menus 
        = render partial: 'menus/user/account'
      - if j == :toolbox
        = render partial: 'toolbox/grading/left/fdb-panel'

- control_panel = [ {for: 'Report Cards', id: 'lnk-st-rc'},
                    {for: 'Inbox', id: 'lnk-st-inbox'},
                    {for: 'Upload', id: 'lnk-upload'},
                    {for: 'Enroll', id: 'lnk-enroll-self'},
                    {for: "Hello, #{student.first_name}", id: 'm-account'} ]

- layout = { left: [ [1, 'students/rc'],
                     [2, 'students/inbox']],
             middle: [],
             right: [],
             wide: [ ['wait', 'toolbox/generic/wait'],
                     ['X', nil] ] }

!!!5

%html{html_attrs}
  %head 
    = javascript_include_tag "application", "students"
    %script{ type: 'text/javascript', src: '//cdn.sublimevideo.net/js/2fya70le.js' }
    %script{ :type => "text/x-mathjax-config" } 
      MathJax.Hub.Config({
      "HTML-CSS" : {
      mtextFontInherit : true
      },
      styles : {
      ".mrow > .mtext" : {
      "font-family" : "Ubuntu 'Trebuchet MS' sans-serif",
      "font-weight" : 300,
      "font-size" : "100%"
      },
      ".mo, .mn" : {
      "font-size" : "70%" 
      }
      }
      });
    = javascript_include_tag "http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"
    = stylesheet_link_tag "application" 
    = csrf_meta_tag

  %body 
    = render partial: 'toolbox/generic/spinner'
    .container-fluid.hidden
      #control-panel.g-panel.row-fluid{ :marker => "#{student.id}" } 
        .span12
          .navbar.navbar-inverse
            .navbar-inner
              %a.brand.span3{ :href => "#"}
                = image_tag "logo-mit-beta-2.png"
              %ul.nav.span8.pull-right
                - for l in control_panel 
                  %li.dropdown 
                    = simple_link for: l[:for], id: l[:id], icon: l[:icon]

      #desktop.row-fluid
        - layout.each do |pnl, child|
          - width = pnl != :wide ? 'span4' : 'span7'
          %div{ id: "#{pnl}", class: "g-panel #{width}" }
            -# Add paginator 
            = render partial: 'toolbox/custom/paginator', locals: { id: "#{pnl}-paginator", url: '#' }
            -# Then, add the { left-, middle-, right-, wide- } as specified in layout
            - child.each do |j|
              %div{ id: "#{pnl}-#{j.first}" }
                = render(partial: "#{j.last}") unless j.last.nil?

    - for j in [:toolbox, :menus, :modals, :notifications]
      = yield j
